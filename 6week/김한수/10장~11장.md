# 10장~11장

- [10장~11장](#10장11장)
- [10장 알림 시스템 설계](#10장-알림-시스템-설계)
  - [데이터 설계 디테일](#데이터-설계-디테일)
  - [안정성](#안정성)
  - [추가 고려 사항](#추가-고려-사항)
- [11장 뉴스 피드 시스템 설계](#11장-뉴스-피드-시스템-설계)
  - [팬아웃 모델](#팬아웃-모델)
  - [풀 모델](#풀-모델)

# 10장 알림 시스템 설계

일반적인 알림 시스템 설계에 대한 이야기

## 데이터 설계 디테일

- 사용자마다 기기는 여러 개일 수 있다. 요구사항에 맞게 판단하자
- 서드파티 서비스와 결합할 때 확장성을 고려하자

## 안정성

`데이터 손실 방지`

- 알림 전송 시스템의 가장 중요한 요구사항 중 하나는 알림이 소실되면 안된다는 점이다.
- 지연되거나 순서가 틀려도 괜찮지만, 사라지면 곤란하다.
- 따라서 알림 데이터를 데이터베이스에 재시도 구조를 구성해야 한다.
  - 알림 로그를 저장하는 것도 하나의 방법이고
  - 메시지 큐를 이용하는 것도 하나의 방법이다.

`알림 중복 전송 방지`

- 알림 중복 방지도 중요하다. 이벤트 ID를 두어서 중복을 체크하자

## 추가 고려 사항

`알림 템플릿`

- 알림 템플릿 기능을 이용해서 운영을 효율화하자

`알림 설정`

- 채널별 알림 설정을 두어서 유저 경험을 개선하자

`전송률 제한`

- 사용자에게 너무 많은 알림을 보내지 않도록 한 유저에 대한 알림 전송률을 제한하자.
- 너무 많이보내면 유저가 알림을 꺼버릴 수도 있다.

`푸시 알림과 보안`

- 알림 발송은 인증되거나 승인된 클라이언트만 가능해야 한다.

`큐 모니터링 시스템`

- 알림 시스템에 구축해둔 큐도 모니터링 하자.
- 큐에 알림이 너무 많이 쌓인다면 병목이 있는 것이므로 작업 서버를 증설하는 액션을 해볼 수 있다.
- 모니터링이 없으면 이런 액션을 하기에는 어렵다

`이벤트 추적`

- 사용자 이벤트를 추적한 데이터를 통해 알림의 효율을 분석하자

# 11장 뉴스 피드 시스템 설계

뉴스 피드 시스템 설계에 대한 이야기

- 스케일링과 관련된 이야기는 이 책의 전반적인 이야기로 갈음하고
- 팬아웃 모델과 풀 모델 중 적절한 걸 선택하라고 함

## 팬아웃 모델

쓰기 시점에 피드를 팬아웃(fanout)하는 모델

- 장점
  - 뉴스 피드가 실시간으로 갱신되고 유저가 빠르게 읽을 수 있음
- 단점
  - 친구가 많은 유저의 경우 연산량이 엄청 많아짐 이는 핫키(hotkey)라고 부르는 문제임
  - 서비스를 자주 사용하지 않는 유저의 데이터도 갱신해야함

## 풀 모델

읽기 시점에 팬아웃하는 모델.

- 피드를 읽어야하는 시점에 데이터를 가져오는 요청 기반(on-demand) 모델
- 장점
  - 비활성화된 유저의 데이터를 갱신할 필요가 없음
  - 핫키 문제도 생기지 않음
- 단점
  - 뉴스 피드를 읽는 데 많은 시간이 소요될 수 있음
