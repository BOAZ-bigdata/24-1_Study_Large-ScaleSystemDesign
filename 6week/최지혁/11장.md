# 문제 이해 및 설계 범위 확정
- 모바일 앱 그리고 웹 둘 다 지원해야 함
- 포스팅 기능 포스팅한 글을 읽는 기능을 가져야 함
- 스토리 순서는 단순히 시간 흐름 역순으로 표시
- 한 명의 사용자는 최대 50,00명의 사용자를 가질 수 있음]
- 트래픽 규모는 10million DAU
- 이미지나 비지오드의 미디어 파일이 포함 되어야 함.

# 개략적인 설계안 제시 및 동의 구하기
뉴스 피드 API를 이용하여 피드 읽기와 발행을 함.
- http 프로토콜을 이용

## 피드 발행
![](https://user-images.githubusercontent.com/42582516/188034106-3d429d53-1aee-4303-bdd9-5d84975b4084.jpeg)
사용자가 API를 사용하면 로드 벨런서가 트래힉을 분산하고 웹 서버는 http 요청을 내부 서비스로 중계한다. 나머지 서비스는 서비스의 역할을 다한다.
## 피드 생성
![](https://user-images.githubusercontent.com/42582516/188034101-2930da25-186d-450b-a5c2-5b71188d9e90.jpeg)


# 상세설계
## 피드 발행 흐름 상세설계
웹서버: 클라이언트 통신, 인증, 처리율 제한 기능 수행
포스팅 전송(팬아웃) 서비스: 포스팅을 친구나 관계있는 모든 사용자에게 전달하는 서비스쓰기 시점, 읽기 시점에 따라 장단점이 갈림
- 쓰기 시점 팬아웃
	- 발행하는 시점에서 실시간 갱신
	- 때문에 피드 읽는 시간이 짧음
	- 다만친구가 많은 사용자의 경우 뉴스 피드 갱신에 시간이 많이 소요됨(핫키 문제)
	- 서비스를 자주 이용하지 않는 이용자의 피드까지 갱신 됨으로 컴퓨터 자원이 낭비됨.

- 읽기 시점 팬아웃
	- 비활성 사용자나 거의 이용하지 않는 사용자의 경우 이 모델이 유리
	- 핫키문제가 사라짐
	- 다만 뉴스 피드를 읽는 시점에서 많은 시간이 소요 됨.
- 하이브리드도 있음.
![](https://i.imgur.com/MBZ897T.png)


## 피드 읽기 흐름 상세 설계
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FcrQMvv%2Fbtrz5OKPK2B%2FD6l5wAHzIKVzxhKNAxekCk%2Fimg.png)
- CDN을 추가하여 이미지나 비디오같은 미디어 콘텐츠를 빨리 읽을 수 있도록 함.
1. 사용자가 API로 요청 보냄
2. 로드밸런서가 요청을 웹 서버 가운데 하나로 보낸다.
3. 웹 서버는 피드를 가져오기 위해 뉴스 피드 서비스를 호출한다.
4. 뉴스 피드 서비스는 캐시에서 포스팅 ID 목록을 가져옴
5. 뉴스 피드에 사용될 사용자 정보는 사용자 캐시와 포스팅 캐시에서 가져옴
6. 생성된 뉴스 피드를 JSON 형태로 반환

## 캐시 구조
이러한 흐름에서도 알 수 있듯 **캐시는 뉴스 피드 시스템의 핵심 컴포넌트**다.
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2F2KaEu%2Fbtrz4MmIzIe%2F8JobsqtAu0YeKrBytOGkwK%2Fimg.png)
- 뉴스 피드
    - 뉴스피드의 ID를 보관한다.
- 콘텐츠
    - 포스팅 데이터를 보관하고 인기 콘텐츠는 따로 보관한다.
- 소셜 그래프
    - 사용자 간 관계 정보를 보관한다. (팔로워, 팔로잉)
- 행동
    - ‘좋아요’나 댓글 같은 사용자 행위에 관한 정보를 보관한다.
- 횟수
    - ‘좋아요’ 횟수, 응답 수, 팔로워 수, 팔로잉 수 등의 정보를 보관한다.

# 마무리
이 외에 면접관과 더 이야기 해보면 좋은 내용
- 데이터베이스 규모 확장
    - 수직정 규모 확장 vs 수평적 규모 확장
    - SQL vs NOSQL
    - 주부(master-slave) 다중화
    - 복제본(replica) dp eogks dlfrrl dustks
    - 일관성 모델(consistency model)
    - 데이터베이스 샤딩(sharding)
- 아래의 추가 사항이 있습니다.
    - 웹 계층(web tier)을 무상태로 운영
    - 가능한 한 많은 데이터를 캐시할 방법
    - 여러 데이터 센터를 지원할 방법
    - 메시지 큐를 사용하여 컴포넌트 사이의 결합도 낮추기
    - 핵심 메트릭에 대한 모니터링