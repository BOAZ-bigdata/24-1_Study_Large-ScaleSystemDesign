# 1장 사용자 수에 따른 규모 확장성
## 단일 서버
- 웹 앱, 데이터베이스, 캐시 등이 전부 한대의 서버에서 운영되는 방식
- 과정: DNS을 사용해서 IP를 얻고 해당 IP로 HTTP요청 후 HTML, JSON 형태의 응답을 받는 형식
- 웹은 HTML, JavaScript를 주로 사용, 앱은 JSON 주로 사용
## 데이터 베이스 
- 관계형 데이터베이스(RDBMS): SQL를 이용해서 주로 처리 구조는 열과 행을 가지는 구조
- 비관계형 데이터베이스(NoSQL): 키-값의 데이터를 가지고 일반적으로 조인 연산을 지원하지 않음

<strong>낮은 지연시간, 비정형데이터, 빅데이터 사용시 -> NoSQL 사용 추천</strong>
## 수직적확장 VS 수평적확장
- 수직적확장: 서버를 더 좋은 자원으로 업그레이드 하는 방식
- 수평적확장: 서버의 물리적인 수를 증가시켜 성능을 업그레이드 하는 방식

<strong>수직적 확장의 한계: 자원을 무한으로 확장 불가능, 장애조치에 어려움</strong>
## 로드벨런서(수평적확장)
- 집합안에 속한 웹 서버들에게 트래픽을 고르게 분산하는 역할을 함
- 문제 발생으로 인해 하나의 서버가 다운되면 다른 서버가 역할을 함 <strong> (장애 대처가능)</strong>
## 데이터베이스 다중화
- Master(쓰기 연산)-Slave(읽기 연산) 구조 
- 안정성, 가용성, 성능이 더 좋은 방식이다. 
## 캐시
- 데이터를 잠시 보관하는 공간으로 데이터베이스보다 빠른 속도를 보장한다.
- 데이터 갱신이 자주 잃어나지 않지만 참조(읽기)작업이 자주 일어나면 유용하다.

<strong>유의사항</strong>
- 더이상 사용하지 않은 데이터를 삭제하기 위한 만료 정책 필요
- 캐시와 저장소간 일관성을 유지하는 방안을 생각해야한다.
- 단일 장애 지점을 피해 여러 지역에 걸쳐 캐시 서버를 분산시킬 필요가 있다. 
- 캐시 메모리를 과할당하여 데이터 과도화시 생길 문제 방지
- LRU, LFU등을 사용하여 데이터 방출을 할것을 고려
## CDN(콘텐츠 전송 네트워크) 
- 정적 콘텐츠를 전송하는데 쓰인 분산 서버 네트워크 이미지, 비디오 등을 캐시 가능 

<strong>고려사항</strong>
- 전송시 비용이 발생하기 때문에 필요한 데이터만 캐싱
- 적절한 만료 시점을 선택해서 컨텐츠의 신선도를 확보
- 장애 발생시 대처 방안을 고려해두기
- 콘텐츠 무효화 방법을 사용해서 필요없는 데이터 제거 

## 무상태 웹 계층
- 상태 정보를 RDS, NoSQL등과 같은 지속적 저장소에 보관하고 필요시 호출할 수 있도록 구축하는 방안.
## 데이터 센터 
- 다중 AZ 혹은 다중 Region을 사용하여 장애가 발생할 때 다른 AZ 혹은 Region으로 트래픽을 전송하여 장애를 극복하는 방안

<strong>중요 사항</strong>
- 데이터 동기화: 트레픽 우회가 발생해도 데이터를 잃지 않게 동기화 해야함.
- 자동화된 배포 도구를 사용해서 모든 데이터 센터에 동일한 서비스가 설치되게 해야함
## 메세지 큐
- 무손실을 보장하는 비동기 통신 컴포넌트
- 생산자, 소비자 구조를 가지고 있다.
- 규모 확장성을 보장해야하는 안정적 애플리케이션 구성시 유용
## 로그, 메트릭, 자동화
- 메트릭을 잘 수집하면 시스템 상태를 잘 확인할 수 있다.
- 호스트 단위 메트릭: CPU, 메모리, 디스크I/O 등
- 종합 메트릭: DB 계층 성능, 캐시 계층 성능 등
- 비지니스 메트릭: 일별 사용자, 수익, 재방문 등
<strong>자동화 도구를 사용해서 개발 생산성을 크게 향상 가능</strong>
## 데이터베이스 규모 확장
- 수직적 확장과 수평적 확장이 있음
- 수평적 확장(샤딩): 샤딩 키(특정 컬럼)를 지정해서 데이터를 분산 시키는 방법을 선택

<strong>주의 사항</strong>
- 재샤딩: 샤드의 수가 부족하면 샤드 키를 계산하는 함수 변경 및 데이터 재배치
- 유명인사 문제: 특정 샤드에 질의가 집중되는 현상, 이 문제를 해결하기 위해 유명인사를 각각의 샤드에 쪼개는 방안으로 해결
- 조인과 비정규화: 조인하기 편하게 하기 위해 데이터베이스를 비정규화 
# 2장 개략적인 규모 추정
## 2의 제곱수
- 1KB: 2^10
- 1MB: 2^20
- 1GB: 2^30
- 1TB: 2^40
- 1PB: 2^50

## 응답지연 값
- L1캐시: 0.5ns
- 분기 예측 오류: 5ns
- L2캐시: 7ns
- 뮤택스 락/언락: 100ns
- 주 메모리 참조: 100ns
- 1KB 압축: 10us
- 1Gbps로 2KB 전송: 20us
- 메모리에서 1MB 순차적 read: 250us
- 메세지 왕복 지연시간: 500us
- 디스크 탐색: 10ms
- 네트워크에서 1MB 순차적 read: 10ms
- 디스크에서 1MB 순차적 read: 30ms
- CA->네덜란드 왕복 지연시간 : 150ms

<strong>수치 분석 결과</strong>
- 메모리는 빨라도 디스크는 아직 느림
- 디스크 탐색은 가능하면 피하기
- 단순한 압축은 빠름
- 데이터를 전송전에 가능하면 압축
- 데이터 센터간 데이터를 주고받는 데는 시간이 걸림 

## 가용성 수치
|가용률|하루당 장애시간|주당 장애시간|개월당 장애시간|연간 장애시간|
|---|---|---|---|---|
|99%|14.4분|1.68시간|7.31시간|3.56일|
|99.9%|1.44분|10.08분|43.83분|8.77시간|
|99.99%|8.64초|1.01분|4.38분|52.6분|
|99.999%|864밀리초|6.05초|26.3초|5.26분|
|99.9999%|86.4밀리초|604.8밀리초|2.63초|31.65초|

<strong>면접 팁</strong>
- 근사치를 활용한 계산
- 가정을 따로 적어둘것
- 단위를 붙여서 계산할 것
- QPS, 최대 OPS, 저장소 요구량, 캐시 요구량, 서버 수등 문제가 많이 출제된다.

# 3장 시스템 설계 면접 공략법
## 효과적 면접을 위한 4단계 접근법
<strong>문제 이해 및 설계 범위 확정 -> 계략적 설계안 제시 및 동의 구하기 -> 상세 설계 -> 마무리</strong>
## 면접시 해야할 것
- 질문을 통해 다시한번 확인하기, 자신의 가정이 잘못될수도 있다.
- 문제 요구사항 이해하기
- 최선의 답안 혹은 정답은 없다.
- 면접관이 나의 사고흐름을 이해할 수 있게 해라 -> 면접관과의 소통
- 가능하면 여러 해법 제시
- 개략적 설계에 면접관이 동의하면, 컴포넌트의 세부사항 설명
- 면접관의 아이디어 이끌어 내기
- 포기하지 말기

## 면접시 하지 말것
- 전형적인 문제를 대비하지 않고 면접장에 가지 말기
- 요구사항이나 가정을 분명하게 하지 않고 설계 제시 하지 말기
- 처음부터 특정 컴포넌트를 너무 깊이 설명하지 말기
- 진행중 막히면, 힌트를 청하기를 주저하지 말기
- 소통에 주저하지 말기
- 설계안을 내놓는 순간 면접이 끝난것이 아니다. 의견을 일찍, 자주 구해라

## 시간 배분(45분 가정)
- 문제 이해 및 설계 범위 확정: 3~10분
- 개략적 설계안 제시 및 동의 구하기: 10~15분
- 상세 설계: 10~25분
- 마무리: 3~5분
