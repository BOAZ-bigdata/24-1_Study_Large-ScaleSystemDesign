#### 개략적인 규모추정이란?
보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위로서, 어떤 설계가 요구사항에 부함할 것인지 보기 위한 것.
- 이를 위해서는 **규모확장성을 표현하는 데 필요한 기본기에 익숙**해져야 한다. 특히 **2의 제곱수나 응답 지연 값 그고 가용성에 관계된 수치**들은 필수적이다.

# 2의 제곱수
데이터 볼륨 단위를 계산하기 위해 사용 (양을 측정) 최소단위는 1바이트(8비트)이다.
아래는 흔히 쓰이는 데이터 볼륨 단위들이다.

| 2의 x 재곰 | 근사치 | 이름 | 단위 |
| ---- | ---- | ---- | ---- |
| 10 | 1천 | 1킬로바이트 | 1KB |
| 20 | 1백만 | 1메가바이트 | 1MB |
| 30 | 10억 | 1기가바이트 | 1GB |
| 40 | 1조 | 1테라베이트 | 1TB |
| 50 | 1000조 | 1페타바이트 | 1PB |

# 응답지연 값
| 연산명           | 시간       |
|:------------------|:------------|
| L1 캐시 참조     | 0.5ns      |
| 분기 예측 오류(branch mispredict) | 5ns       |
| L2 캐시 참조     | 7ns        |
| 뮤텍스(mutex) 잠금/언락 | 100ns      |
| 주 메모리 참조    | 100ns      |
| Zippy로 1 KB 압축  | 10,000ns = 10μs |
| 1 Gbps 네트워크로 2 KB 전송 | 20,000ns = 20μs |
| 메모리에서 1 MB 순차적으로 read | 250,000ns = 250μs |
| 같은 데이터 센터 내에서의 메시지 왕복 지연시간 | 500,000ns = 500μs |
| 디스크 탐색(seek)  | 10,000,000ns = 10ms |
| 네트워크에서 1 MB 순차적으로 read | 10,000,000ns = 10ms |
| 디스크에서 1 MB 순차적으로 read | 30,000,000ns = 30ms |
| 한 패킷의 CA(캘리포니아)부터 네덜란드까지의 왕복 지연시간 | 150,000,000ns = 150ms |
- 단위
- ns = nanosecond(나노초), μs = microsecond(마이크로초), ms = millisecond(밀리초)  
- 1나노초 = 10^-9초  
- 1마이크로초 = 10^-6초 = 1,000나노초  
- 1밀리초 = 10^-3초 = 1,000μs = 1,000,000ns  


결론적으로 다음과 같다.
- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색(seek)은 가능한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라(gzip).
- 데이터 센터는 보통 여러 지역에 분산되어 있고 센터들 간에 데이터를 주고받는데는 시간이 걸린다.

# 가용성에 관계된 수치들
> 고가용성이란?  
> 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭하는 용어다.  
> 100%는 시스템이 단 한 번도 중단된 적이 없었음을 의미한다.


|가용률|하루당 장애시간|주당 장애시간|개월당 장애시간|연간 장애시간|
|:---|:---|:---|:---|:---|
|99%|14.4분|1.68시간|7.31시간|3.56일|
|99.9%|1.44분|10.08분|43.83분|8.77시간|
|99.99%|8.64초|1.01분|4.38분|52.6분|
|99.999%|864밀리초|6.05초|26.3초|5.26분|
|99.9999%|86.4밀리초|604.8밀리초|2.63초|31.65초|
## 예제: 트위터 QPS와 저장소 요구량 추정

#### 가정
- 월간 능동 사용자는 3억 명이다
- 50%의 사용자가 트위터를 매일 사용한다
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
- 미디어를 포함하는 트윗은 10% 정도다
- 데이터는 5년간 보관된다

#### 추정

- 월간 능동 사용자는 3억 명이다
- 50%의 사용자가 트위터를 매일 사용한다
- 3억 * 50% = 1.5억 명

#### QPS(Query Per Second) 추정치

- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
- QPS = 1.5억 * 2 트윗 / 24시간 / 1분(3600초) = 약 3500
- 최대 QPS = 3500 * 2 = 약 7000

#### 미디어 저장을 위한 저장소 요구량

- 평균 트윗 크기(avg)
    - tweet_id 에 64바이트
    - 텍스트에 140바이트
    - 미디어에 1MB
- 미디어를 포함하는 트윗은 10% 정도
    - 1.5억 × 2 × 10% × 1MB = 30TB/일
- 5년간 미디어를 보관하기 위한 저장소 요구량
    - 30TB × 365일 × 5년 = 약 55PB

# TIP
개략적인 규모 추정과 관계된 면접에서 가장 중요한 것은 **문제를 풀어 나가는 절차**다.  
**올바른 절차를 밟느냐**가 결과를 내는 것보다 중요하다. 면접자가 보고 싶어하는 것은 **문제 해결 능력**이다.

- 근사치를 활용한 계산
	- 정확한 수치가 중요한 것이 아님 계산에 시간을 낭비하지 말 것
- 가정을 적어두어라
	- 일일이 다 기억하는 것은 어려우므로 가정들은 메모해두자
- 단위를 붙여라
	- 5라고만 적으면 5MB, 5GB인지 알 수 없다. 단위를 붙이는 습관을 들여라
- QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 문제들이 다수 출제
	- 미리 계산에 익숙해질 필요가 있음.